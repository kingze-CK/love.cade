<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>心动信号</title>
    <style>
        * { margin: 0; padding: 0; }
        body { background: #0a0a1a; overflow: hidden; touch-action: none; }
        canvas { display: block; }
        /* 触摸提示 */
        #tip { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); color: #ffc0cb; font-size: 14px; opacity: 0.8; pointer-events: none; }
    </style>
</head>
<body>
    <div id="tip">点击屏幕，生成更多爱心❤️</div>
    <canvas id="loveCanvas"></canvas>

    <script>
        const canvas = document.getElementById('loveCanvas');
        const ctx = canvas.getContext('2d');
        let w = window.innerWidth;
        let h = window.innerHeight;
        canvas.width = w;
        canvas.height = h;
        let hearts = [];
        let touchX = 0, touchY = 0;
        let isTouched = false;

        // 爱心类（优化性能）
        class Heart {
            constructor(x = null, y = null) {
                this.x = x || Math.random() * w;
                this.y = y || Math.random() * h;
                this.size = Math.random() * 1.5 + 0.5;
                this.speedX = (Math.random() - 0.5) * 0.4;
                this.speedY = (Math.random() - 0.5) * 0.4 - 0.2; // 轻微向上飘
                this.alpha = Math.random() * 0.5 + 0.5;
                // 粉/红渐变色
                this.color = `rgba(${255}, ${Math.floor(100 + Math.random() * 100)}, ${Math.floor(150 + Math.random() * 50)}, ${this.alpha})`;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                // 边界反弹
                if (this.x < 0 || this.x > w) this.speedX *= -1;
                if (this.y < 0 || this.y > h) this.speedY *= -1;
                // 触摸时生成的爱心，额外向上飘
                if (isTouched) this.y -= 0.3;
            }

            draw() {
                ctx.save();
                ctx.beginPath();
                // 爱心数学路径（简化计算）
                const scale = this.size;
                ctx.moveTo(this.x, this.y);
                ctx.bezierCurveTo(
                    this.x + 30 * scale, this.y - 30 * scale,
                    this.x + 90 * scale, this.y + 15 * scale,
                    this.x, this.y + 60 * scale
                );
                ctx.bezierCurveTo(
                    this.x - 90 * scale, this.y + 15 * scale,
                    this.x - 30 * scale, this.y - 30 * scale,
                    this.x, this.y
                );
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }
        }

        // 初始化30个爱心
        function initHearts() {
            for (let i = 0; i < 30; i++) hearts.push(new Heart());
        }

        // 触摸屏幕生成爱心
        canvas.addEventListener('touchstart', (e) => {
            isTouched = true;
            touchX = e.touches[0].clientX;
            touchY = e.touches[0].clientY;
            // 一次生成10个爱心
            for (let i = 0; i < 10; i++) hearts.push(new Heart(touchX, touchY));
        });

        canvas.addEventListener('touchend', () => {
            isTouched = false;
        });

        // 动画循环（优化性能）
        function animate() {
            requestAnimationFrame(animate);
            // 半透明覆盖，实现拖影效果
            ctx.fillStyle = 'rgba(10, 10, 26, 0.1)';
            ctx.fillRect(0, 0, w, h);
            // 只渲染可见爱心，避免性能浪费
            hearts.forEach((heart, index) => {
                heart.update();
                heart.draw();
                // 移除透明度过低的爱心
                if (heart.alpha < 0.1) hearts.splice(index, 1);
            });
        }

        // 窗口适配
        window.addEventListener('resize', () => {
            w = window.innerWidth;
            h = window.innerHeight;
            canvas.width = w;
            canvas.height = h;
        });

        // 启动
        initHearts();
        animate();
    </script>
</body>
</html>
